# Conversational BI Tool

A **Conversational Business Intelligence system** that allows users to ask natural-language questions over structured data and receive **validated SQL, charts, summaries, and explainability**, powered by a **hybrid of deterministic logic and local LLMs**.

This project focuses on the *hard part of analytics*:
**making data interpretable, and usable for non-technical users.**

## ğŸš€ Overview

This system enables users to:

* Ask questions in plain English
* Automatically generate **safe SQL**
* View **appropriate visualizations**
* Read **business-friendly summaries**
* Inspect **SQL and execution details**
* Persist and manage multi-session chats
* Export full conversations to PDF

## âœ¨ Key Features

* ğŸ§  **Natural Language â†’ SQL** with validation
* ğŸ”’ **SQL Guardrails** (SELECT-only, safe limits)
* ğŸ“Š **Deterministic + LLM-assisted chart selection**
* ğŸ“ˆ **Predefined chart renderers** (no LLM-generated code)
* ğŸ§¾ **Executive summaries** for business users
* ğŸ” **Explainability panel** (SQL, attempts, metadata)
* ğŸ’¬ **Multi-chat sessions** with rename, search, delete
* ğŸ’¾ **SQLite persistence** for chats and history
* ğŸ“„ **Export chat to PDF** (tables, charts, SQL)
* ğŸ§ª **Unit-tested core logic**
* ğŸ  **Local LLMs via Ollama** (no cloud dependency)

## ğŸ§± Architecture Overview

The system intentionally separates **deterministic logic** from **LLM assistance**.

```
User
 â†“
Streamlit UI
 â†“
Agent
 â”œâ”€ Text â†’ SQL (LLM)
 â”‚   â””â”€ SQL Guard (validation + limits)
 â”œâ”€ SQL Executor (SQLite)
 â”œâ”€ Result Inspector (shape + types)
 â”œâ”€ Chart Selection
 â”‚   â”œâ”€ Rules (preferred)
 â”‚   â””â”€ LLM (fallback)
 â”œâ”€ Chart Renderers (fixed, safe)
 â”œâ”€ Executive Summary Generator (LLM)
 â†“
Renderer
 â†“
SQLite (Chats, Messages, History)
```

> LLMs are **never allowed to generate SQL execution or visualization code**.

## ğŸ—„ï¸ Data & Query Logic

* Uses a **relational dataset** (Brazilian E-Commerce / Olist)
* Schema metadata is explicitly provided to the LLM
* SQL is generated first, then **validated**, then executed
* Automatic limits prevent large or unsafe queries

## ğŸ§  LLM Usage & Guardrails

LLMs are used **only where they add value**:

| Task                  | Approach                         |
| --------------------- | -------------------------------- |
| SQL generation        | LLM + schema + rules             |
| SQL safety            | Deterministic guard              |
| Result classification | Deterministic                    |
| Chart selection       | Deterministic â†’ LLM fallback     |
| Summaries             | LLM (bounded, business-friendly) |
| Follow-up questions   | LLM with fallback rules          |

**Model used locally**:

* `qwen2.5-coder:7b` via Ollama
* `phi4-mini:3.8b` via Ollama

This keeps the system:

* Fast
* Private
* Reproducible
* Cost-free

## ğŸ“Š Visualization Logic

Visualizations are **never generated by the LLM**.

Supported renderers:

* Metric (single value)
* Line chart (time series)
* Bar chart (categorical)
* Table (fallback)

Chart type is chosen by:

1. Deterministic inspection (preferred)
2. LLM selection from an **explicit allow-list**

## ğŸ’¬ Chat Management & Persistence

* Multi-chat support
* Rename chats
* Search chats
* Clear current chat
* Delete chat / delete all chats
* Persisted in **SQLite**

Chat history survives reloads and restarts.

## ğŸ“„ Export to PDF

Each chat can be exported to PDF including:

* Questions
* Rendered charts (images)
* Result tables
* Generated SQL
* Execution time

Suggestions are intentionally excluded to keep exports clean.

## ğŸ§ª Testing & Quality

Minimal but meaningful unit tests cover:

* SQL guard validation
* Result classification
* Chart selection logic

All core logic is tested without calling real LLMs.

## ğŸ“Œ Future improvements may include:

* Role-based access
* Dataset switching
* More Visualization Options